sudo: true
language: cpp
cache:
  directories:
  - "$HOME/google-cloud-sdk/"
env:
# Make sure gcloud command is on our PATH and the App Engine SDK is in the Python path
- GAE_PYTHONPATH=${HOME}/.cache/google_appengine PATH=$PATH:${HOME}/google-cloud-sdk/bin PYTHONPATH=${PYTHONPATH}:${GAE_PYTHONPATH} CLOUDSDK_CORE_DISABLE_PROMPTS=1

os: linux

compiler:
  - gcc

before_install:
  - if [ ! -d "${GAE_PYTHONPATH}" ]; then
      python scripts/fetch_gae_sdk.py $(dirname "${GAE_PYTHONPATH}");
    fi
  - if [ ! -d ${HOME}/google-cloud-sdk ]; then
       curl https://sdk.cloud.google.com | bash;
    fi
  - tar -xzf credentials.tar.gz
  - mkdir -p lib
  - gcloud auth activate-service-account --key-file client-secret.json
  - sudo sed -i -e 's/^Defaults\tsecure_path.*$//' /etc/sudoers
  - sudo apt-get update
  - sudo apt-get install flawfinder

install:
  - gcloud config set project $GCLOUD_PROJECT
  - gcloud -q components update gae-python
  - git clone http://www.github.com/gmkurtzer/singularity
  - cd singularity
  - ./autogen.sh
  - ./configure --prefix=/usr/local
  - make
  - sudo make install

script:
  - sudo singularity create image.img
  - sudo singularity bootstrap image.img Singularity
